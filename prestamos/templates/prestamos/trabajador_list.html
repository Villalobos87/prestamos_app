{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Trabajadores</h3>
  <a href="{% url 'prestamos:trabajador_create' %}" class="btn btn-success">
    ➕ Nuevo
  </a>
</div>

<!-- Tabla de trabajadores -->
<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table id="trabajadoresTable" class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <!-- Encabezado principal -->
          <tr>
            <th style="width: 15%;">Código</th>
            <th style="width: 55%;">Nombre</th>
            <th style="width: 30%;">Campus</th>
          </tr>
          <!-- Filtros por columna -->
          <tr>
            <th><input type="text" class="form-control form-control-sm" placeholder="Buscar código"></th>
            <th><input type="text" class="form-control form-control-sm" placeholder="Buscar nombre"></th>
            <th><input type="text" class="form-control form-control-sm" placeholder="Buscar campus"></th>
          </tr>
        </thead>
        <tbody>
          {% for t in items %}
            <tr>
              <td>{{ t.codigo }}</td>
              <td>{{ t.nombre }}</td>
              <td>{{ t.campus }}</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="3" class="text-center text-muted">⚠️ No se encontraron trabajadores</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- DataTables CSS y JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function () {
  // Inicializar DataTable
  var table = $('#trabajadoresTable').DataTable({
    orderCellsTop: true,
    fixedHeader: true,
    language: {
      url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
    }
  });

  // Filtros en cada columna
  $('#trabajadoresTable thead tr:eq(1) th').each(function (i) {
    $('input', this).on('keyup change', function () {
      if (table.column(i).search() !== this.value) {
        table.column(i).search(this.value).draw();
      }
    });
  });
});
</script>
{% endblock %}